<h2>注文履歴詳細</h2>

<table class="table table-bordered">
    <tbody>
       <tr>
         <td>購入者</td>
         <td><%= @order.customer.last_name%> <%= @order.customer.first_name%></td>
       </tr>

       <tr>
         <td>注文日</td>
         <td><%= @order.created_at%></td>
       </tr>

       <tr>
         <td>配送先</td>
         <td>〒<%=@order.postal_code%><br><%=@order.address%><br><%=@order.name%></td>
       </tr>

       <tr>
         <td>支払方法</td>
         <td><%= @order.payment_method%></td>
       </tr>

       <tr>
         <td>注文ステータス</td>
         <%= form_with model: @order, url: admin_order_path(@order),method: :patch, local: true  do |f| %>
         <td>
             <%= f.select(:status,[["入金待ち"],["入金確認"],["製作中"],["発送準備中"],["発送済み"]])%>
             <%= f.submit "変更" %>
         </td>
         <%end%>
       </tr>
    </tbody>
</table>


<table class="table table-striped">
  <thead>
    <tr>
      <th>商品名</th>
      <th>単価（税込）</th>
      <th>数量</th>
      <th>小計</th>
      <th>制作ステータス</th>
      <th colspan="5"></th>
    </tr>
  </thead>

  <tbody>
    <% @order.order_details.each do |order_detail| %>
      <tr>
        <td><%= order_detail.item.name%></td>
        <td><%= order_detail.price%></td>
        <td><%= order_detail.amount%></td>
        <td><%= order_detail.price*order_detail.amount%></td>
        
        <%= form_with model: order_detail, url: admin_order_detail_path(order_detail),method: :patch, local: true  do |f| %>
        <td>
        　<%= f.select(:making_status,[["制作不可"],["制作待ち"],["製作中"],["制作完了"]])%>
        　<%= f.submit "変更" %>
        </td>
        <%end%>
        
      </tr>
    <% end %>
  </tbody>
</table>


<table class="table table-bordered">
    <tbody>
       <tr>
         <td>商品合計</td>
         <td><%=( @order.total_payment - @order.shipping_cost ) / 1.1 %>
         </td>
       </tr>
       
       <tr>
         <td>配送料</td>
         <td><%=@order.shipping_cost%></td>
       </tr>
       
       <tr>
         <td>請求金額合計</td>
         <td><%=@order.total_payment%></td>
       </tr>
       
    </tbody>
</table>